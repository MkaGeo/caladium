<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>База классических сортов каладиумов (2024)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        accent: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #111827;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Плавная анимация для модальных окон */
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        /* Кастомный скроллбар */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Анимация для карточек */
        .plant-card {
            transition: all 0.2s ease;
        }
        
        .plant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Эффект градиента для шапки */
        .header-gradient {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.9) 0%, rgba(139, 92, 246, 0.9) 100%);
        }
        
        /* Эффект параллакса для героя */
        .parallax {
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        /* Анимация загрузки */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Кастомные стили для таблицы */
        .table-container {
            position: relative;
        }
        
        .table-header {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .table-row {
            transition: background-color 0.2s ease;
        }
        
        /* Эффект стекла для модального окна */
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Адаптация для очень маленьких экранов */
        @media (max-width: 480px) {
            .hero-title {
                font-size: 1.5rem;
            }
            .hero-subtitle {
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Шапка -->
    <header class="header-gradient shadow-md text-white">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://cdn.store.link/uploads/store14587/store-logo.jpg?versionId=KnvYooNJLl6yuLhukJB6ZxjlkYfEW3hV" 
                     alt="CaladiumHome Logo" 
                     class="h-10 w-10 rounded-full border-2 border-white shadow-sm">
                <h1 class="text-xl font-bold tracking-tight">CaladiumHome</h1>
            </div>
            <a href="https://t.me/caladiums" 
               target="_blank" 
               class="bg-white text-primary-600 p-2 rounded-full hover:bg-gray-100 transition-all duration-300 shadow-sm hover:shadow-md">
                <i class="fab fa-telegram text-lg"></i>
            </a>
        </div>
    </header>

    <!-- Hero Banner -->
    <section class="parallax bg-gray-900 text-white relative" 
             style="background-image: url('https://cdn.store.link/products/store14587/r8m5q8-1738617436308.jpg?versionId=TYf9HDxK2ZyBVN8tNrEIp3hK6Du28V8X')">
        <div class="absolute inset-0 bg-black opacity-40"></div>
        <div class="relative container mx-auto px-4 py-12 md:py-20 flex items-center justify-center">
            <div class="text-center max-w-3xl">
                <h2 class="hero-title text-3xl md:text-4xl lg:text-5xl font-bold mb-4 leading-tight">
                    Каталог классических сортов каладиумов
                </h2>
                <p class="hero-subtitle text-lg md:text-xl text-gray-100 mb-6">
                    🍃 Актуальный перечень с указанием селекционных линий разведения, историческими данными и информацией о родителях (2025)
                </p>
                <button class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-full font-medium transition-all duration-300 shadow-md hover:shadow-lg">
                    <i class="fas fa-leaf mr-2"></i> Каталог сортов
                </button>
            </div>
        </div>
    </section>

    <!-- Основной контейнер -->
    <div class="flex flex-1 overflow-hidden">
        <!-- Левая панель (каталог/таблица) -->
        <div class="w-full lg:w-3/5 flex flex-col border-r border-gray-200 bg-white">
            <!-- Поиск и фильтры -->
            <div class="p-4 bg-white border-b border-gray-200">
                <div class="flex flex-col md:flex-row gap-3">
                    <div class="relative flex-1">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" 
                               id="search" 
                               placeholder="Поиск по названию сорта..." 
                               class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    <button id="filterToggle" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-sliders-h mr-2"></i> Фильтры
                    </button>
                </div>
                
                <!-- Дополнительные фильтры (скрыты по умолчанию) -->
                <div id="advancedFilters" class="hidden mt-3 p-4 bg-gray-50 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Высота растения</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                                <option value="">Любая</option>
                                <option value="low">Низкая (до 40 см)</option>
                                <option value="medium">Средняя (40-60 см)</option>
                                <option value="high">Высокая (60+ см)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Форма листа</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                                <option value="">Любая</option>
                                <option value="heart">Сердцевидная</option>
                                <option value="lance">Ланцетная</option>
                                <option value="fancy">Фэнси</option>
                                <option value="strap">Ремневидная</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Цвет листьев</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                                <option value="">Любой</option>
                                <option value="red">Красный</option>
                                <option value="pink">Розовый</option>
                                <option value="white">Белый</option>
                                <option value="green">Зелёный</option>
                                <option value="mixed">Смешанный</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Устойчивость к солнцу</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                                <option value="">Любая</option>
                                <option value="high">Высокая</option>
                                <option value="medium">Средняя</option>
                                <option value="low">Низкая</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Переключение вида -->
            <div class="flex border-b border-gray-200 bg-gray-50">
                <button id="directoryViewBtn" 
                        class="flex-1 py-3 px-4 text-center font-medium text-primary-600 border-b-2 border-primary-600 transition-all duration-300">
                    <i class="fas fa-list mr-2"></i> Каталог
                </button>
                <button id="tableViewBtn" 
                        class="flex-1 py-3 px-4 text-center font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300 transition-all duration-300">
                    <i class="fas fa-table mr-2"></i> Таблица
                </button>
                <button id="cardViewBtn" 
                        class="flex-1 py-3 px-4 text-center font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300 transition-all duration-300">
                    <i class="fas fa-th-large mr-2"></i> Карточки
                </button>
            </div>
            
            <!-- Контейнер с прокруткой для таблицы/каталога -->
            <div class="flex-1 overflow-y-auto relative">
                <!-- Загрузка (изначально скрыта) -->
                <div id="loadingIndicator" class="hidden absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-50">
                    <div class="text-center">
                        <div class="w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-gray-700 font-medium">Загрузка данных...</p>
                    </div>
                </div>
                
                <!-- Таблица (изначально скрыта) -->
                <div id="tableView" class="hidden h-full">
                    <div class="table-container h-full">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 table-header">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-300" data-sort="ID">
                                        <div class="flex items-center">
                                            ID
                                            <span class="sort-icon ml-1"></span>
                                        </div>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-300" data-sort="Сорт">
                                        <div class="flex items-center">
                                            Сорт
                                            <span class="sort-icon ml-1"></span>
                                        </div>
                                        <input type="text" class="filter-input mt-1 w-full px-2 py-1 border border-gray-300 rounded text-xs" placeholder="Фильтр...">
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-300" data-sort="Патент">
                                        <div class="flex items-center">
                                            Патент
                                            <span class="sort-icon ml-1"></span>
                                        </div>
                                        <input type="text" class="filter-input mt-1 w-full px-2 py-1 border border-gray-300 rounded text-xs" placeholder="Фильтр...">
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-300" data-sort="Высота (см)">
                                        <div class="flex items-center">
                                            Высота (см)
                                            <span class="sort-icon ml-1"></span>
                                        </div>
                                        <input type="text" class="filter-input mt-1 w-full px-2 py-1 border border-gray-300 rounded text-xs" placeholder="Фильтр...">
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-300" data-sort="Ширина листа (см)">
                                        <div class="flex items-center">
                                            Ширина (см)
                                            <span class="sort-icon ml-1"></span>
                                        </div>
                                        <input type="text" class="filter-input mt-1 w-full px-2 py-1 border border-gray-300 rounded text-xs" placeholder="Фильтр...">
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Данные будут вставлены через JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Каталог (изначально видим) -->
                <div id="directoryView" class="h-full p-4">
                    <div id="directoryContent" class="space-y-6"></div>
                </div>
                
                <!-- Вид карточек (изначально скрыт) -->
                <div id="cardView" class="hidden h-full p-4">
                    <div id="cardContent" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                
                <!-- Сообщение, если ничего не найдено -->
                <div id="noResults" class="hidden h-full flex items-center justify-center p-8">
                    <div class="text-center">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700">Ничего не найдено</h3>
                        <p class="text-gray-500 mt-1">Попробуйте изменить параметры поиска</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Правая панель (детали) -->
        <div class="hidden lg:flex lg:w-2/5 flex-col bg-gray-50 border-l border-gray-200">
            <div class="details-container flex-1 overflow-y-auto p-6">
                <div id="featuresFrame">
                    <div class="flex flex-col items-center justify-center h-full text-center p-8">
                        <i class="fas fa-leaf text-5xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-medium text-gray-700 mb-2">Выберите сорт каладиума</h3>
                        <p class="text-gray-500 max-w-md">Здесь будет отображаться подробная информация о выбранном сорте, включая фотографии, характеристики и исторические данные.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для изображения -->
    <div id="imageModal" class="modal fixed inset-0 z-50 hidden opacity-0 invisible">
        <div class="absolute inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4">
            <span class="close absolute top-6 right-6 text-white text-3xl cursor-pointer hover:text-gray-300 transition-colors duration-300">
                &times;
            </span>
            <div class="modal-content max-w-4xl w-full">
                <img id="modalImage" class="modal-image max-h-screen mx-auto rounded-lg shadow-xl">
            </div>
        </div>
    </div>
    
    <!-- Модальное окно для мобильной версии -->
    <div id="mobileModal" class="fixed inset-0 z-50 bg-white hidden overflow-y-auto">
        <div class="sticky top-0 bg-white p-4 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-lg font-medium">Информация о сорте</h3>
            <button onclick="closeMobileModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-6" id="mobileModalContent"></div>
    </div>

    <script>
        // Парсинг CSV данных
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(';').map(h => h.trim());
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const obj = {};
                const currentline = lines[i].split(';').map(c => c.trim());
                
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = currentline[j] || '';
                }
                
                result.push(obj);
            }
            
            return result;
        }

        // Данные сортов в CSV формате (разделитель - точка с запятой)
        const csvData = `
ID;Сорт;Селекционная линия;Год;Патент;Ссылка на патент;Селекционер;Родители;Высота (см);Ширина листа (см);Форма листа;Окрас;Устойчивость к солнцу;Историческая справка;Особенности;Ссылка на изображение
1;75-14;UF;2010;PP21089;https://patents.justia.com/patent/PP21089;Zhanao Deng, Brent Harbaugh;Не указаны в патенте;50-70;15-25;Сердцевидная;Белый центр, зелёные края, пурпурные пятна;Высокая;Выведен в Университете Флориды, отличается высокой урожайностью клубней;Крупные листья с контрастным рисунком;https://cdn.store.link/products/store14587/r8m5q8-1738617436308.jpg
2;Aaron;;;;;;40-45;15-17;Сердцевидная;Белый/зелёный;Полутень;Назван в честь сына селекционера;Компактный;https://cdn.store.link/products/store14587/aaron-1738617436308.jpg
3;Alabama;UF;1993;PP8875;https://patents.justia.com/patent/PP8875;Robert Hartman;Не указаны в патенте;45-60;20-30;Сердцевидная;Красный с зелёными краями;Высокая;Популярный коммерческий сорт;Яркие прожилки;https://cdn.store.link/products/store14587/alabama-1738617436308.jpg
4;Apple Blossom;;;;;;50-70;15-25;Сердцевидная;Розовый с зелёными краями;Средняя;Классический розовый сорт;Нежные прожилки;https://cdn.store.link/products/store14587/apple-blossom-1738617436308.jpg
5;Autumn Beauty;;;;;;40-60;15-20;Ланцетная;Красный с зелёными пятнами;Высокая;Осенняя окраска;Компактный рост;https://cdn.store.link/products/store14587/autumn-beauty-1738617436308.jpg
6;Brandywine;;;;;;50-70;20-30;Сердцевидная;Красный с зелёными краями;Высокая;Назван в честь реки;Крупные листья;https://cdn.store.link/products/store14587/brandywine-1738617436308.jpg
7;Candidum;;;;;;50-60;15-25;Сердцевидная;Белый с зелёными прожилками;Полутень;Старый классический сорт;Чувствителен к солнцу;https://cdn.store.link/products/store14587/candidum-1738617436308.jpg
8;Carolyn Whorton;;;;;;50-70;20-30;Сердцевидная;Розовый с зелёными краями;Средняя;Назван в честь селекционера;Крупные листья;https://cdn.store.link/products/store14587/carolyn-whorton-1738617436308.jpg
9;Florida Cardinal;UF;1985;PP5739;https://patents.justia.com/patent/PP5739;Robert Hartman;Не указаны в патенте;45-60;15-25;Сердцевидная;Красный с зелёными краями;Высокая;Один из первых запатентованных сортов UF;Яркая окраска;https://cdn.store.link/products/store14587/florida-cardinal-1738617436308.jpg
10;Florida Moonlight;UF;2002;PP13858;https://patents.justia.com/patent/PP13858;Zhanao Deng, Brent Harbaugh;Не указаны в патенте;50-70;15-25;Сердцевидная;Белый с зелёными прожилками;Средняя;Популярный белый сорт UF;Крупные листья;https://cdn.store.link/products/store14587/florida-moonlight-1738617436308.jpg
11;Florida Sweetheart;UF;1985;PP5740;https://patents.justia.com/patent/PP5740;Robert Hartman;Не указаны в патенте;40-50;15-20;Сердцевидная;Розовый с зелёными краями;Средняя;Компактный розовый сорт UF;Обильное цветение;https://cdn.store.link/products/store14587/florida-sweetheart-1738617436308.jpg
12;Frieda Hemple;;;;;;50-70;20-30;Сердцевидная;Красный с зелёными краями;Высокая;Классический красный сорт;Крупные листья;https://cdn.store.link/products/store14587/frieda-hemple-1738617436308.jpg
13;Gingerland;;;;;;40-50;15-20;Сердцевидная;Белый с зелёными пятнами;Полутень;Компактный сорт;Нежные прожилки;https://cdn.store.link/products/store14587/gingerland-1738617436308.jpg
14;Miss Muffet;;;;;;30-40;10-15;Сердцевидная;Розовый с зелёными пятнами;Полутень;Карликовый сорт;Компактный рост;https://cdn.store.link/products/store14587/miss-muffet-1738617436308.jpg
15;Pink Beauty;;;;;;50-70;15-25;Сердцевидная;Розовый с зелёными краями;Средняя;Популярный розовый сорт;Нежные прожилки;https://cdn.store.link/products/store14587/pink-beauty-1738617436308.jpg
16;Pink Cloud;;;;;;50-70;20-30;Сердцевидная;Розовый с зелёными краями;Средняя;Назван за нежную окраску;Крупные листья;https://cdn.store.link/products/store14587/pink-cloud-1738617436308.jpg
17;Red Flash;;;;;;50-70;20-30;Сердцевидная;Красный с зелёными пятнами;Высокая;Яркий контрастный сорт;Крупные листья;https://cdn.store.link/products/store14587/red-flash-1738617436308.jpg
18;Rosebud;;;;;;50-70;15-25;Сердцевидная;Розовый с зелёными краями;Средняя;Нежная розовая окраска;Компактный рост;https://cdn.store.link/products/store14587/rosebud-1738617436308.jpg
19;White Christmas;;;;;;50-70;15-25;Сердцевидная;Белый с зелёными прожилками;Полутень;Популярный белый сорт;Чувствителен к солнцу;https://cdn.store.link/products/store14587/white-christmas-1738617436308.jpg
20;White Queen;;;;;;50-70;15-25;Сердцевидная;Белый с красными прожилками;Полутень;Контрастный сорт;Чувствителен к солнцу;https://cdn.store.link/products/store14587/white-queen-1738617436308.jpg
294;White Wonder;;;;;;50-70;15-25;Ремневидная;Бело-серый с тёмно-зелёными краями;Средняя;Популярный белый сорт;Нежные прожилки;https://cdn.store.link/products/store14587/white-wonder-1738617436308.jpg
`;

        // Преобразуем CSV в массив объектов
        const caladiums = parseCSV(csvData.trim());
        let currentSortField = 'ID';
        let sortDirection = 1;
        let currentView = 'directory';
        let tableFilters = {
            'Сорт': '',
            'Патент': '',
            'Высота (см)': '',
            'Ширина листа (см)': ''
        };
        let selectedItem = null;

        // Рассчитываем диапазоны высот
        function calculateHeightRanges() {
            const heights = [];
            
            caladiums.forEach(item => {
                const heightRange = item['Высота (см)'].split('-');
                const min = parseInt(heightRange[0]) || 0;
                const max = parseInt(heightRange[1] || heightRange[0]) || 0;
                heights.push(min, max);
            });
            
            const minHeight = Math.min(...heights);
            const maxHeight = Math.max(...heights);
            const range = maxHeight - minHeight;
            
            return {
                low: { min: minHeight, max: minHeight + range/3 },
                medium: { min: minHeight + range/3, max: minHeight + 2*range/3 },
                high: { min: minHeight + 2*range/3, max: maxHeight }
            };
        }

        // Рассчитываем диапазоны ширины листа
        function calculateWidthRanges() {
            const widths = [];
            
            caladiums.forEach(item => {
                const widthRange = item['Ширина листа (см)'].split('-');
                const min = parseInt(widthRange[0]) || 0;
                const max = parseInt(widthRange[1] || widthRange[0]) || 0;
                widths.push(min, max);
            });
            
            const minWidth = Math.min(...widths);
            const maxWidth = Math.max(...widths);
            const range = maxWidth - minWidth;
            
            return {
                narrow: { min: minWidth, max: minWidth + range/3 },
                medium: { min: minWidth + range/3, max: minWidth + 2*range/3 },
                wide: { min: minWidth + 2*range/3, max: maxWidth }
            };
        }

        const heightRanges = calculateHeightRanges();
        const widthRanges = calculateWidthRanges();

        // Сортировка данных
        function sortData(field) {
            if (currentSortField === field) {
                sortDirection = -sortDirection;
            } else {
                currentSortField = field;
                sortDirection = 1;
            }
            
            caladiums.sort((a, b) => {
                const valA = a[field] || '';
                const valB = b[field] || '';
                
                // Для числовых значений сортируем по среднему значению диапазона
                if (field === 'Высота (см)' || field === 'Ширина листа (см)') {
                    const getAvg = (str) => {
                        const range = str.split('-');
                        const min = parseInt(range[0]) || 0;
                        const max = parseInt(range[1] || range[0]) || 0;
                        return (min + max) / 2;
                    };
                    
                    return (getAvg(valA) - getAvg(valB)) * sortDirection;
                }
                
                return valA.localeCompare(valB) * sortDirection;
            });
            
            updateSortIndicators();
            updateCurrentView();
        }
        
        // Обновление индикаторов сортировки
        function updateSortIndicators() {
            document.querySelectorAll('.sort-icon').forEach(icon => {
                icon.innerHTML = '';
            });
            
            const currentHeader = document.querySelector(`th[data-sort="${currentSortField}"]`);
            if (currentHeader) {
                const icon = currentHeader.querySelector('.sort-icon');
                if (icon) {
                    icon.innerHTML = sortDirection === 1 ? 
                        '<i class="fas fa-sort-up"></i>' : 
                        '<i class="fas fa-sort-down"></i>';
                }
            }
        }

        // Заполнение таблицы
        function populateTable(data) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            // Применяем фильтры
            const filteredData = data.filter(item => {
                return Object.entries(tableFilters).every(([key, value]) => {
                    if (!value) return true;
                    return String(item[key]).toLowerCase().includes(value.toLowerCase());
                });
            });
            
            if (filteredData.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                document.getElementById('tableView').classList.add('hidden');
                return;
            } else {
                document.getElementById('noResults').classList.add('hidden');
                document.getElementById('tableView').classList.remove('hidden');
            }
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'table-row hover:bg-gray-50';
                row.dataset.id = item['ID'];
                
                if (selectedItem && selectedItem['ID'] === item['ID']) {
                    row.classList.add('bg-primary-50');
                }
                
                // ID
                const idCell = document.createElement('td');
                idCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
                idCell.textContent = item['ID'];
                row.appendChild(idCell);
                
                // Сорт
                const sortCell = document.createElement('td');
                sortCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium';
                sortCell.textContent = item['Сорт'];
                row.appendChild(sortCell);
                
                // Патент
                const patentCell = document.createElement('td');
                patentCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                if (item['Патент'] && item['Ссылка на патент']) {
                    const patentLink = document.createElement('a');
                    patentLink.href = item['Ссылка на патент'];
                    patentLink.textContent = item['Патент'];
                    patentLink.target = '_blank';
                    patentLink.className = 'text-primary-600 hover:text-primary-800 hover:underline';
                    patentCell.appendChild(patentLink);
                } else {
                    patentCell.textContent = item['Патент'] || '—';
                }
                row.appendChild(patentCell);
                
                // Высота
                const heightCell = document.createElement('td');
                heightCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                heightCell.textContent = item['Высота (см)'];
                row.appendChild(heightCell);
                
                // Ширина листа
                const widthCell = document.createElement('td');
                widthCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                widthCell.textContent = item['Ширина листа (см)'];
                row.appendChild(widthCell);
                
                // Обработчик клика для строки
                row.addEventListener('click', () => {
                    selectItem(item, row);
                });
                
                tableBody.appendChild(row);
            });
            
            // Выделить первую строку, если есть данные и не мобильная версия
            if (filteredData.length > 0 && window.innerWidth > 768 && !selectedItem) {
                const firstRow = tableBody.querySelector('tr');
                if (firstRow) {
                    selectItem(filteredData[0], firstRow);
                }
            }
        }

        // Заполнение каталога
        function populateDirectory(data) {
            const directoryContent = document.getElementById('directoryContent');
            directoryContent.innerHTML = '';
            
            // Фильтрация по поиску
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const filteredData = data.filter(item => 
                item['Сорт'].toLowerCase().includes(searchTerm)
            );
            
            if (filteredData.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                document.getElementById('directoryView').classList.add('hidden');
                return;
            } else {
                document.getElementById('noResults').classList.add('hidden');
                document.getElementById('directoryView').classList.remove('hidden');
            }
            
            // Группировка по первой букве названия сорта
            const groupedData = {};
            filteredData.forEach(item => {
                const firstLetter = item['Сорт'].charAt(0).toUpperCase();
                if (!groupedData[firstLetter]) {
                    groupedData[firstLetter] = [];
                }
                groupedData[firstLetter].push(item);
            });
            
            // Сортировка букв алфавита
            const letters = Object.keys(groupedData).sort();
            
            letters.forEach(letter => {
                const letterGroup = document.createElement('div');
                letterGroup.className = 'letter-group';
                
                const letterHeader = document.createElement('div');
                letterHeader.className = 'flex items-center mb-2';
                
                const letterBadge = document.createElement('div');
                letterBadge.className = 'bg-primary-100 text-primary-800 rounded-full w-8 h-8 flex items-center justify-center font-bold mr-3';
                letterBadge.textContent = letter;
                
                const letterTitle = document.createElement('h3');
                letterTitle.className = 'text-lg font-semibold text-gray-800';
                letterTitle.textContent = `Сорта на букву ${letter}`;
                
                letterHeader.appendChild(letterBadge);
                letterHeader.appendChild(letterTitle);
                letterGroup.appendChild(letterHeader);
                
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'grid grid-cols-1 md:grid-cols-2 gap-2';
                
                groupedData[letter].forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow duration-300 cursor-pointer';
                    
                    if (selectedItem && selectedItem['ID'] === item['ID']) {
                        itemElement.classList.add('ring-2', 'ring-primary-500');
                    }
                    
                    itemElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h4 class="font-medium text-gray-900">${item['Сорт']}</h4>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                                ${item['Высота (см)']} см
                            </span>
                        </div>
                        <div class="mt-2 text-sm text-gray-500">
                            ${item['Форма листа']} • ${item['Окрас']}
                        </div>
                    `;
                    
                    itemElement.addEventListener('click', () => {
                        selectItem(item, itemElement);
                    });
                    
                    itemsContainer.appendChild(itemElement);
                });
                
                letterGroup.appendChild(itemsContainer);
                directoryContent.appendChild(letterGroup);
            });
            
            // Выделить первый элемент, если есть данные и не мобильная версия
            if (filteredData.length > 0 && window.innerWidth > 768 && !selectedItem) {
                const firstItem = directoryContent.querySelector('.letter-group:first-child .bg-white');
                if (firstItem) {
                    selectItem(filteredData[0], firstItem);
                }
            }
        }
        
        // Заполнение карточек
        function populateCards(data) {
            const cardContent = document.getElementById('cardContent');
            cardContent.innerHTML = '';
            
            // Фильтрация по поиску
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const filteredData = data.filter(item => 
                item['Сорт'].toLowerCase().includes(searchTerm)
            );
            
            if (filteredData.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                document.getElementById('cardView').classList.add('hidden');
                return;
            } else {
                document.getElementById('noResults').classList.add('hidden');
                document.getElementById('cardView').classList.remove('hidden');
            }
            
            filteredData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'plant-card bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300';
                
                if (selectedItem && selectedItem['ID'] === item['ID']) {
                    card.classList.add('ring-2', 'ring-primary-500');
                }
                
                const imageUrl = item['Ссылка на изображение'] || 'https://via.placeholder.com/300x200?text=No+Image';
                
                card.innerHTML = `
                    <div class="h-48 overflow-hidden">
                        <img src="${imageUrl}" alt="${item['Сорт']}" 
                             class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                             onclick="openImageModal('${imageUrl}')">
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-start">
                            <h3 class="text-lg font-semibold text-gray-900 mb-1">${item['Сорт']}</h3>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                                ${item['Высота (см)']} см
                            </span>
                        </div>
                        <p class="text-sm text-gray-500 mb-2">${item['Форма листа']} • ${item['Окрас']}</p>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500">${item['Селекционер'] || 'Не указан'}</span>
                            <span class="text-primary-600 font-medium">${item['Год'] || '—'}</span>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', (e) => {
                    // Игнорируем клики по изображению (у него свой обработчик)
                    if (!e.target.closest('img')) {
                        selectItem(item, card);
                    }
                });
                
                cardContent.appendChild(card);
            });
            
            // Выделить первую карточку, если есть данные и не мобильная версия
            if (filteredData.length > 0 && window.innerWidth > 768 && !selectedItem) {
                const firstCard = cardContent.querySelector('.plant-card:first-child');
                if (firstCard) {
                    selectItem(filteredData[0], firstCard);
                }
            }
        }
        
        // Выбор элемента
        function selectItem(item, element) {
            selectedItem = item;
            
            // Удаляем выделение у всех элементов
            document.querySelectorAll('.table-row, .directory-item, .plant-card').forEach(el => {
                el.classList.remove('bg-primary-50', 'ring-2', 'ring-primary-500');
            });
            
            // Добавляем выделение текущему элементу
            if (element) {
                if (currentView === 'table') {
                    element.classList.add('bg-primary-50');
                } else {
                    element.classList.add('ring-2', 'ring-primary-500');
                }
            }
            
            if (window.innerWidth <= 768) {
                openMobileModal(item);
            } else {
                updateFeatures(item);
                updateUrl(item['Сорт']);
            }
        }
        
        // Обновление URL
        function updateUrl(sortName) {
            const cleanSortName = sortName.toLowerCase().replace(/\s+/g, '-');
            const newUrl = `${window.location.pathname}#${cleanSortName}`;
            window.history.pushState({}, '', newUrl);
        }

        // Обновление блока с особенностями
        function updateFeatures(item) {
            const featuresFrame = document.getElementById('featuresFrame');
            
            if (item) {
                const colorMap = {
                    'Высокая': 'bg-green-100 text-green-800',
                    'Средняя': 'bg-yellow-100 text-yellow-800',
                    'Низкая': 'bg-red-100 text-red-800',
                    'Полутень': 'bg-blue-100 text-blue-800',
                    'Тень': 'bg-purple-100 text-purple-800'
                };
                
                const sunTolerance = item['Устойчивость к солнцу'] || 'Не указана';
                const sunClass = colorMap[sunTolerance] || 'bg-gray-100 text-gray-800';
                
                featuresFrame.innerHTML = `
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        ${item['Ссылка на изображение'] ? `
                        <div class="h-64 overflow-hidden">
                            <img src="${item['Ссылка на изображение']}" 
                                 alt="${item['Сорт']}" 
                                 class="w-full h-full object-cover hover:scale-105 transition-transform duration-500 cursor-pointer"
                                 onclick="openImageModal('${item['Ссылка на изображение']}')">
                        </div>
                        ` : ''}
                        
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h2 class="text-2xl font-bold text-gray-900">${item['Сорт']}</h2>
                                <span class="text-xs ${sunClass} px-2 py-1 rounded-full">
                                    ${sunTolerance}
                                </span>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-500 mb-1">Высота</div>
                                    <div class="font-medium">${item['Высота (см)']} см</div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-500 mb-1">Ширина листа</div>
                                    <div class="font-medium">${item['Ширина листа (см)']} см</div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-500 mb-1">Форма листа</div>
                                    <div class="font-medium">${item['Форма листа']}</div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-500 mb-1">Окрас</div>
                                    <div class="font-medium">${item['Окрас']}</div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                ${item['Селекционная линия'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Селекционная линия</h4>
                                    <p class="mt-1">${item['Селекционная линия']}</p>
                                </div>
                                ` : ''}
                                
                                ${item['Селекционер'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Селекционер</h4>
                                    <p class="mt-1">${item['Селекционер']}</p>
                                </div>
                                ` : ''}
                                
                                ${item['Год'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Год</h4>
                                    <p class="mt-1">${item['Год']}</p>
                                </div>
                                ` : ''}
                                
                                ${item['Патент'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Патент</h4>
                                    <p class="mt-1">
                                        <a href="${item['Ссылка на патент']}" 
                                           target="_blank" 
                                           class="text-primary-600 hover:underline">
                                            ${item['Патент']}
                                        </a>
                                    </p>
                                </div>
                                ` : ''}
                                
                                ${item['Родители'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Родители</h4>
                                    <p class="mt-1">${item['Родители']}</p>
                                </div>
                                ` : ''}
                                
                                ${item['Особенности'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Особенности</h4>
                                    <p class="mt-1">${item['Особенности']}</p>
                                </div>
                                ` : ''}
                                
                                ${item['Историческая справка'] ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500">Историческая справка</h4>
                                    <p class="mt-1">${item['Историческая справка']}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                featuresFrame.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center p-8">
                        <i class="fas fa-leaf text-5xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-medium text-gray-700 mb-2">Выберите сорт каладиума</h3>
                        <p class="text-gray-500 max-w-md">
                            Здесь будет отображаться подробная информация о выбранном сорте, 
                            включая фотографии, характеристики и исторические данные.
                        </p>
                    </div>
                `;
            }
        }
        
        // Функция для открытия модального окна с изображением
        function openImageModal(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100', 'visible');
            }, 10);
            
            modalImg.src = imageUrl;
            
            // Закрытие модального окна
            document.querySelector('.close').onclick = function() {
                modal.classList.remove('opacity-100', 'visible');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
            
            // Закрытие при клике вне изображения
            modal.onclick = function(event) {
                if (event.target === modal) {
                    modal.classList.remove('opacity-100', 'visible');
                    setTimeout(() => {
                        modal.classList.add('hidden');
                    }, 300);
                }
            }
        }
        
        // Функция для открытия мобильного модального окна
        function openMobileModal(item) {
            const modal = document.getElementById('mobileModal');
            const modalContent = document.getElementById('mobileModalContent');
            
            const colorMap = {
                'Высокая': 'bg-green-100 text-green-800',
                'Средняя': 'bg-yellow-100 text-yellow-800',
                'Низкая': 'bg-red-100 text-red-800',
                'Полутень': 'bg-blue-100 text-blue-800',
                'Тень': 'bg-purple-100 text-purple-800'
            };
            
            const sunTolerance = item['Устойчивость к солнцу'] || 'Не указана';
            const sunClass = colorMap[sunTolerance] || 'bg-gray-100 text-gray-800';
            
            modalContent.innerHTML = `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                    ${item['Ссылка на изображение'] ? `
                    <div class="h-48 overflow-hidden">
                        <img src="${item['Ссылка на изображение']}" 
                             alt="${item['Сорт']}" 
                             class="w-full h-full object-cover hover:scale-105 transition-transform duration-500 cursor-pointer"
                             onclick="openImageModal('${item['Ссылка на изображение']}')">
                    </div>
                    ` : ''}
                    
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h2 class="text-xl font-bold text-gray-900">${item['Сорт']}</h2>
                            <span class="text-xs ${sunClass} px-2 py-1 rounded-full">
                                ${sunTolerance}
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-gray-50 p-2 rounded-lg">
                                <div class="text-xs text-gray-500 mb-1">Высота</div>
                                <div class="font-medium">${item['Высота (см)']} см</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded-lg">
                                <div class="text-xs text-gray-500 mb-1">Ширина</div>
                                <div class="font-medium">${item['Ширина листа (см)']} см</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded-lg">
                                <div class="text-xs text-gray-500 mb-1">Форма</div>
                                <div class="font-medium">${item['Форма листа']}</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded-lg">
                                <div class="text-xs text-gray-500 mb-1">Окрас</div>
                                <div class="font-medium">${item['Окрас']}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    ${item['Селекционная линия'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Селекционная линия</h4>
                        <p>${item['Селекционная линия']}</p>
                    </div>
                    ` : ''}
                    
                    ${item['Селекционер'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Селекционер</h4>
                        <p>${item['Селекционер']}</p>
                    </div>
                    ` : ''}
                    
                    ${item['Год'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Год</h4>
                        <p>${item['Год']}</p>
                    </div>
                    ` : ''}
                    
                    ${item['Патент'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Патент</h4>
                        <p>
                            <a href="${item['Ссылка на патент']}" 
                               target="_blank" 
                               class="text-primary-600 hover:underline">
                                ${item['Патент']}
                            </a>
                        </p>
                    </div>
                    ` : ''}
                    
                    ${item['Родители'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Родители</h4>
                        <p>${item['Родители']}</p>
                    </div>
                    ` : ''}
                    
                    ${item['Особенности'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Особенности</h4>
                        <p>${item['Особенности']}</p>
                    </div>
                    ` : ''}
                    
                    ${item['Историческая справка'] ? `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-500 mb-1">Историческая справка</h4>
                        <p>${item['Историческая справка']}</p>
                    </div>
                    ` : ''}
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        // Функция для закрытия мобильного модального окна
        function closeMobileModal() {
            document.getElementById('mobileModal').classList.add('hidden');
        }
        
        // Обновление текущего вида
        function updateCurrentView() {
            switch(currentView) {
                case 'table':
                    if (document.getElementById('tableView').classList.contains('hidden')) {
                        populateTable(caladiums);
                    }
                    break;
                case 'directory':
                    populateDirectory(caladiums);
                    break;
                case 'cards':
                    populateCards(caladiums);
                    break;
            }
        }
        
        // Переключение между видами
        function toggleView(view) {
            currentView = view;
            
            // Скрыть все виды
            document.getElementById('tableView').classList.add('hidden');
            document.getElementById('directoryView').classList.add('hidden');
            document.getElementById('cardView').classList.add('hidden');
            
            // Сбросить активные кнопки
            document.getElementById('tableViewBtn').classList.remove('text-primary-600', 'border-primary-600');
            document.getElementById('directoryViewBtn').classList.remove('text-primary-600', 'border-primary-600');
            document.getElementById('cardViewBtn').classList.remove('text-primary-600', 'border-primary-600');
            
            document.getElementById('tableViewBtn').classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent', 'hover:border-gray-300');
            document.getElementById('directoryViewBtn').classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent', 'hover:border-gray-300');
            document.getElementById('cardViewBtn').classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent', 'hover:border-gray-300');
            
            // Показать выбранный вид и активировать кнопку
            switch(view) {
                case 'table':
                    document.getElementById('tableView').classList.remove('hidden');
                    document.getElementById('tableViewBtn').classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent', 'hover:border-gray-300');
                    document.getElementById('tableViewBtn').classList.add('text-primary-600', 'border-primary-600');
                    populateTable(caladiums);
                    break;
                case 'directory':
                    document.getElementById('directoryView').classList.remove('hidden');
                    document.getElementById('directoryViewBtn').classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent', 'hover:border-gray-300');
                    document.getElementById('directoryViewBtn').classList.add('text-primary-600', 'border-primary-600');
                    populateDirectory(caladiums);
                    break;
                case 'cards':
                    document.getElementById('cardView').classList.remove('hidden');
                    document.getElementById('cardViewBtn').classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent', 'hover:border-gray-300');
                    document.getElementById('cardViewBtn').classList.add('text-primary-600', 'border-primary-600');
                    populateCards(caladiums);
                    break;
            }
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Обработчики сортировки
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', () => {
                    const sortField = header.getAttribute('data-sort');
                    sortData(sortField);
                });
            });
            
            // Обработчики фильтров таблицы
            document.querySelectorAll('.filter-input').forEach(input => {
                const header = input.closest('th');
                const field = header.getAttribute('data-sort');
                
                input.addEventListener('input', () => {
                    tableFilters[field] = input.value;
                    populateTable(caladiums);
                });
            });
            
            // Обработчик поиска
            const searchInput = document.getElementById('search');
            let searchTimeout;
            
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                document.getElementById('loadingIndicator').classList.remove('hidden');
                
                searchTimeout = setTimeout(() => {
                    updateCurrentView();
                    document.getElementById('loadingIndicator').classList.add('hidden');
                }, 300);
            });
            
            // Инициализация кнопок переключения вида
            document.getElementById('tableViewBtn').addEventListener('click', () => {
                toggleView('table');
                // Убедимся что таблица заполнена данными
                if (document.getElementById('tableView').classList.contains('hidden')) {
                    populateTable(caladiums);
                }
            });
            document.getElementById('directoryViewBtn').addEventListener('click', () => toggleView('directory'));
            document.getElementById('cardViewBtn').addEventListener('click', () => toggleView('cards'));
            
            // Обработчик кнопки фильтров
            document.getElementById('filterToggle').addEventListener('click', () => {
                document.getElementById('advancedFilters').classList.toggle('hidden');
            });
            
            // Отображаем данные в каталоге при загрузке
            toggleView('directory');
            
            // Обработка хэша URL при загрузке
            const hash = window.location.hash.substring(1);
            if (hash) {
                const sortName = hash.replace(/-/g, ' ');
                const item = caladiums.find(c => 
                    c['Сорт'].toLowerCase() === sortName.toLowerCase()
                );
                
                if (item) {
                    selectedItem = item;
                    updateFeatures(item);
                    
                    // Прокрутка к выбранному элементу после загрузки данных
                    setTimeout(() => {
                        if (currentView === 'table') {
                            const row = document.querySelector(`tr[data-id="${item['ID']}"]`);
                            if (row) {
                                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        } else {
                            const element = document.querySelector(`[data-id="${item['ID']}"]`) || 
                                           document.querySelector(`[onclick*="selectItem(${item['ID']}"]`);
                            if (element) {
                                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }
</body>
</html>